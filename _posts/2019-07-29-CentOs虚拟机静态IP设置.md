---
layout: post
title: "CentOs虚拟机静态IP设置"
date: 2019-07-29 16:16
categories: [linux]
tags: [linux]
---

这篇文章主要记录采用VMWare最小化安装CentOS 7后如何设置静态IP，以及遇到的问题的解决方案。
PS：本来是没想写文章记录的，因为觉得配置的东西都很简单，结果最近换电脑折腾这个东西又弄了大半天。

# 背景介绍
------------
我这里采用`最小化`安装CentOS 7，安装过程略过不表。安装成功后执行`ifconfig`、`route`等命令会提示找不到，其实这些命令都集成到`ip`命令中了，通过`ip addr`可以查看IP地址，`ip route list`查看当前路由表，更多信息可以查看帮助手册`man ip`，`SEE ALSO`章节列出了相关的子命令的查看方法。

采用`NAT模式`设置虚拟机的静态IP，主要包括两个环节：
1. 设置虚拟网络
2. 配置虚拟机IP

我主机的网段是`192.168.0.0`，子网掩码`255.255.0.0`，虚拟机的网段打算配置到`192.168.111.0`，子网掩码`255.255.255.0`。

# 设置虚拟网络
-------------
在VMWare的`编辑`菜单中选择`虚拟网络编辑器`，这里采用NAT模式，故修改`VMnet8`的配置信息，静态IP需要去掉DHCP服务选项，配置好子网`192.168.111.0`和对应的掩码`255.255.255.0`，点击`NAT设置`设置默认的网关`192.168.111.2`。

这里完成了宿主机的虚拟网络设置。

# 虚拟机静态IP设置
-----------------
CentOS设置静态IP是修改`/etc/sysconfig/network-scripts`下对应网卡的配置文件，我的机器是`ifcfg-ens32`，主要修改以下几个参数：
```bash
BOOTPROTO=static
IPADDR=192.168.111.61
NETMASK=255.255.255.0
GATWAY=192.168.111.2
ONBOOT=yes
```

以上配置给虚拟机分配了一个静态IP：192.168.111.61，一般来说到这里宿主机和虚拟机就可以互相访问了，但实际中有些设置会导致无法访问。

# 问题
------
我在实际安装中主要遇到以下三个问题：
1. 宿主机和虚拟机互相ping不通
遇到这个问题，注意检查宿主机和虚拟机的防火墙，如果正在运行，尝试关闭后再试。CentOS查看防火墙状态`systemctl status firewalld`，关闭防火墙`systemctl stop firewalld`，如果要禁用则`systemctl disable firewalld`。

2. 防火墙关闭后虚拟机ping不通宿主机
遇到这个问题网上查了很多资料，都没找到解决方案，最后发现可能是路由表问题，于是利用`ip route list`查了下当前系统的路由表，发现确实是没有路由信息，利用`ip route add default via 192.168.111.2 dev ens32`添加了默认的网关`192.168.111.2`后解决。

3. ping百度（www.baidu.com）不通，但ping指定IP可以
这种就是域名解析问题，配置DNS即可，在`/etc/sysconfig/network-scripts`下对应网卡配置文件中添加DNS信息即可。
